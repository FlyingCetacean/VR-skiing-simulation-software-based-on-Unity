*计算机图形学* *课程大作业报告*

 

# 基于 Unity 的 VR 滑雪仿真软件的设计与实现

王正 于昌明

[toc]

**摘 要:** 

近年来大众对于滑雪运动的热情不断提高，但许多人由于滑雪具有一定危险性而不敢参与到滑雪运动中。同时，现有的场地和设备资源难以满足人们对滑雪运动的强烈需求。而正在快速发展的虚拟现实技术提供了一个解决问题的方法：本小组利用`Unity`游戏引擎及其提供的`VR`设计并实现了一款模拟滑雪软件。使用者可以在这款滑雪软件中身临其境地体验滑雪的乐趣。通过虚拟现实技术来模拟滑雪的场景，通过场景仿真和物理仿真来最大化地还原滑雪的体验。同时本项目可以保证滑雪的安全性，最大限度保证使用者的安全，规避了此类高风险运动的安全隐患。总体上来讲，该系统本，保证了运动的安全性，并同时保留了滑雪的刺激感与乐趣,具有良好的实用性、扩展性和安全性。

 

**关键词：** 虚拟现实 冬奥会 滑雪模拟 `Unity`

 

Design and implementation of VR ski simulation software based on Unity

Wang Zheng Yu Changming

**Abstract**: In recent years, the public's enthusiasm for skiing has been increasing, but many people do not dare to participate in skiing because of its certain dangers. At the same time, the existing venue and equipment resources can not meet people's strong demand for skiing. The rapidly developing virtual reality technology provides a solution to this problem: the team designed and implemented a simulation skiing software using the Unity game engine and the VR provided by it. Users can experience the fun of skiing in an immersive way. Virtual reality technology is used to simulate the skiing scene, and scene simulation and physical simulation are used to maximize the skiing experience. At the same time, this project can ensure the safety of skiing, maximize the safety of users, and avoid the potential safety hazards of such high-risk sports. Generally speaking, this system ensures the safety of sports, and retains the excitement and fun of skiing, with good practicability, expansibility and safety. 

**Key word****：****Virtual reality Winter Olympics Ski simulation Unity**

 

 

# **1**   简介与意义/Introduction

## **1.1**   项目意义和依据/Significance

从2016年VR快速发展至今，已经有很多VR游戏发布。但其中运动模拟类游戏仅占了很小的一部分，而模拟滑雪的游戏更是少见，且质量也并不高。2022年我国将在北京举办冬奥会。随着冬奥会的展开，社会上一定会形成一股冰雪运动的浪潮，滑雪这项运动的热度也一定升高。但现有的运动设施存在一定的局限性，不能满足所有需求。而VR滑雪软件可以为大众提供一个替代品，可以在一定程度上满足大众的需求。

实现滑雪模拟的难点主要有两点：VR与物理模拟。VR的大部分游戏都将玩家局限在一定的空间内，而剩下的可以自由移动的游戏，使用的也是手柄的摇杆或者是直接的瞬移。因此如何将VR的操纵与滑雪本来的性质联系在一起是一个难题。物理模拟是比起VR建构更难的难题。现有的物理引擎对于物理的模拟并不真实，有许多的问题。本次项目使用的Unity引擎其中的物理引擎是英伟达的 physx 物理引擎。经过试验，若只使用引擎中的刚体与碰撞体组件，无法模拟滑雪中滑雪杆与地面碰撞对人物造成的影响。因此，需要通过C#脚本对滑雪中的物理效果进行模拟。

## **1.2**   本方法/系统框架/Article Structure 

​                                                                 

​          图 1 项目主要架构          




本次项目基于Unity进行系统设计，分别进行场景仿真和物理仿真，其中物理仿真所使用的物理引擎是英伟达的 physx 物理引擎。项目的整体框架如图 1所示



# **2**   相关工作/Related Works 

## **2.1**   虚拟现实

虚拟现实（VR）是一种可以与现实世界相似或完全不同的模拟体验。当前，标准的虚拟现实系统使用虚拟现实耳机或多投影环境来生成逼真的图像，声音和其他感觉，以模拟用户在虚拟环境中的物理存在。

虚拟现实技术在上个世纪50年代中期出现。到现在已经经历上世纪90年代和2010年代两次热潮。今天，虚拟现实技术已经被用在许多的领域。2016年以来，VR游戏进入爆发式增长阶段，大量的VR游戏进入市场。但是，与此同时，VR游戏种类较少，质量参差不齐的问题也逐渐显现。

## **2.2**   物理仿真

  对于滑雪的力学分析已经有不少。通过论文可以发现，滑雪中的力学是一个极其复杂的系统。但开发VR滑雪，并不需要这么复杂的物理学仿真，我们可以通过简单的设置，让使用者感到自己在滑雪即可实现我们的目标。

# **3**   研究内容与方法(或算法)/Contnts and Methods(or Algorithm)

## **3.1**   场景建模

本次项目所模拟的项目模拟的滑雪项目是高山滑雪，因此赛道的建设是在雪山之上。建设赛道需要建模，本小组选择了Unity自带的地形系统进行地形创建。

Unity的地形系统自带的笔刷系统可以很方便地升高和降低地形，也可以使用笔刷柔和地形，或者在地形涂抹材质来增添细节，如图 2所示。通过使用地形纹理笔刷，可以对于地形的表面纹理进行进一步的优化，可以给予地形岩石和雪地的纹理，如图 3所示。

 

图 2地形高度笔刷示例

 

 

图 3地形纹理笔刷

为了得到更加逼真的场景效果，优化场景的细节，提升场景的美观度，地形的自带树笔刷，可以通过添加树的模型，便利地为雪山植树，当然添加其他模型就可以用同样的方式添加其他的地形细节，如图 4所示。

 

图 4地形树笔刷示例

除了赛道地形的绘制之外，为了提高系统使用的沉浸感、真实感和美观度，本小组还在场景内添加了一些细节模型，如赛道旁的栅栏，起点处的旗帜，赛道旁的雪人和远处的山川等。本小组还为这些细节模型添加了刚体属性，以确保它们可以有正确的碰撞效果。

除此之外，本项目还使用了其他的一些工具，如天空盒Skybox和粒子效果来达到美化模型的目的。天空盒子可以提供美观的天空背景。粒子系统的使用则可以制作出雪花飘落的效果。以上内容中所使用到的素材都来源自Unity的资源商店或网上的免费资源。

## **3.2**   VR控制的实现

在Unity 的VR控制可以使用多种方法的实现，如可以使用steam与VIVE在Unity官方商店中的SteamVR Plugin，VIVE Input Utility插件进行开发。本项目使用的是Unity新发布的XR Interaction Toolkit，现还处于预览阶段。如图 5所示。

 

图 5XR Interaction Toolkit 插件

 

XR Interaction Toolkit 是一个基于组件的高级交互系统，它将各个VR设备的输入统一化，只需要使用它就可以为市面上的主流VR设备提供适配。为了它能正常工作，需要在项目中载入各个VR设备厂家所提供的的SDK。SDK在项目设置的XR Plug-in Management中加载。在Player的XR Setting中可以将支持VIVE的OpenVR SDK加载到项目中。如图 6所示。

 

图 6添加VR设备的SDK

将以上步骤完成后，正式进入VR控制设置。首先需要一个空组件，并将Camera Rig脚本添加到此物体上。然后为其创建一个名为Camera Offset的子物体。在这个子物体下再创建一个摄像机和两个空物体，空物体对应的是两个控制器。最后为这些组件添加相应的脚本文件并设置完毕。设置如图 7图 8所示：

 

图 7 VR控制设置a

 

 

图 8 VR 控制设置b

 

由于并不需要VR控制器的抓取并交互功能，所以两个控制器上并没有添加相应的脚本。至此，VR的基本控制已经可以实现。

## **3.3**   物理仿真

本项目的物理仿真分为两个部分：重力与摩擦模拟，滑雪杆滑雪仿真。

重力与摩擦模拟部分比较简单。我们将游玩人物物理模型抽象为一个长方体，且其重心较低。这样做的好处在于可以有效地减少其倾倒的概率。于实现而言，我们为控制物添加刚体组件，然后添加碰撞体组件，并设置碰撞体的形状。这样就实现了重力的效果。而滑雪的场地与滑雪板间的摩擦系数较小，不能使用默认的物理材质。因此，本项目创建了新的物理材质，并根据资料与测试效果设立了摩擦系数。将地形与控制物的碰撞体的物理材质设为自定义的物理材质，即可完成对摩擦的仿真。

 

 

图 9雪物理材质

滑雪杆的操作及物理仿真中，本小组曾尝试过几种方式。

刚开始时，本小组希望利用Unity中的碰撞体组件进行实现。具体做法为在脚本中写入对碰撞的反应。当碰撞时检测碰撞的杆子，并根据碰撞的滑雪杆不同做出不同的反应。但Unity中的碰撞体之间的碰撞检测需要至少一方具有刚体。地形无法添加刚体组件，而滑雪杆如果要添加刚体，需要比较复杂的操作才能使其与操作杆一起运动。因此此方法行不通。

为了得到碰撞检测但不需要刚体，使用了脚本实现射线检测碰撞。在每个时间间隔后，会从滑雪杆中心处沿滑雪杆方向发射一条射线，若在滑雪杆一半长度内与碰撞体相交，说明发生碰撞。此时，会得到滑雪杆，即控制器的挥动速度，乘上权重，根据滑雪杆选择对应的操作。若是左滑雪杆，则添加向前的力，和向右的转矩。如果是右滑雪杆，则是向前的力与向左的转矩。经过测试，此方法能够检测碰撞，且效果也能起作用，但并不稳定。此后尝试了改进方法，如将施加力改成施加向量，但依然不尽如人意。

综上，我们使用了更为简单的方法。不进行碰撞检测，当玩家挥动控制器时，若方向向下，则为控制物添加作用力。作用力的添加与上文中的效果一样。



# **4**   实验结果与分析/Experiment Results and Analysis 

## **4.1**   场景建模

本项目最终实现的滑雪赛道及周边场景较为美观、真实地展现了滑雪的环境。较大地提升了使用时的沉浸感和真实感。最终的场景如图 9图 10图 11所示：

 

图 10 场景示例1

 

 

图 11 场景示例2

 

图 12场景示例3

## **4.2**   运行状态

本项目最终实现了通过VR手柄的控制，进行滑雪过程中的前进、转向、减速等操作：

当使用者两手同时向后划动时，可以向前滑动并加速；当使用者右手向后划动，左手保持不动时，可以实现向左转向；相反，当使用者左手向后划动，右手保持不动时，可以实现向右转向；当速度过快或想要停下时，扣动右手手柄的扳机可实现减速。如表格 1所示

 

| 具体操作                   | 实现效果         |
| -------------------------- | ---------------- |
| 两手同时向后划动           | 向前滑动并加速   |
| 右手向后划动，左手保持不动 | 向左转向         |
| 左手向后划动，右手保持不动 | 向右转向         |
| 扣动右手手柄的扳机         | 实现减速直至停止 |

表格 1 具体操作及实现效果

运行过程截图如下图 12图 13所示：

 

图 13 运行截图a

 

图 14 运行截图b

总体上，本项目可实现较为灵敏和真实的滑雪体验。视觉上，本项目的场景美观，有比较多的细节呈现。操作体验上，系统可以即时、灵敏地对使用者的操作做出反应。最大程度上还原真实滑雪的体感体验。

# **5**   特色与创新/ Distinctive or Innovation Points

通过本项目，通过虚拟现实技术来模拟滑雪。在有效规避此类高风险运动的安全隐患的同时，让更多的人直观、便捷地感受滑雪运动乐趣。与现在已有的一些VR游戏相比，本项目结合时事热点，较为紧密地贴合了2022冬奥会在即这一大背景下，人们对冰雪类项目热情日益高涨的主题。同时，本项目更加注重一些细节的实现，致力于细节化场景内容，这一点也区别于其他的VR模拟系统。

同时，本项目同样也存在一些值得继续研究、继续改进的地方。通过手柄控制方向和速度的参数可以进一步优化更新；可以考虑设计一个UI交互界面；还可以进一步打磨模型的细节和材质。

 

 

References:

  [1]  Jeff W Murray. Building Virtual Reality with Unity and Steam VR[M].CRC Press:2020-03-21.

  [2]  Virtual reality - Wikipedia.https://en.wikipedia.org/wiki/Virtual_reality

 

附中文参考文献:

[1]  张帅,伍传敏.Unity3D环境下的沉浸类虚拟现实系统设计与实现[J].宜宾学院学报,2018,18(12):10-13.

[2]  Unity网站官方教程https://docs.unity3d.com/cn/2019.4/Manual/VROverview.html

 

 

 

 

 

附录：

时间安排与分工统计表

 

| **组员信息**                    |                                                              |        |              |
| ------------------------------- | ------------------------------------------------------------ | ------ | ------------ |
| 学生姓名                        | 王正                                                         | 学  号 | 518021910079 |
| 项目分工                        | 资料查找、场景建模、物理仿真参数调整                         |        |              |
| 学生姓名                        | 于昌明                                                       | 学  号 | 518021910284 |
| 项目分工                        | 资料查找、VR控制、物理仿真调整                               |        |              |
| **时间安排****/**  **Schedule** | l   8——11周：相关资料查找与学习  l   11——12周：场景建模与初步VR控制  l   12——14周：场景细节补充、VR控制优化、物理仿真尝试多种碰撞检测方法。  l   14——15周：确定场景、选择效果最优的碰撞检测方法及控制方法；优化各个物理参数。如力矩大小，摩擦力大小……  l   16周：撰写报告、录制视频、制作演示文稿。 |        |              |

 # VR-skiing-simulation-software-based-on-Unity
